<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ows.edu.dao.OrderViewDao">
	<resultMap id="orderViewMap" type="orderView">
		<result property="orderItemNo" column="OI_NO"/>
		<result property="orderDate" column="ORD_DT"/>
		<result property="orderNo" column="ORD_NO"/>
		<result property="clientName" column="CLT_NAME"/>
		<result property="itemName" column="ITM_NAME"/>
		<result property="itemCode" column="ITM_CODE"/>
		<result property="orderItemQuantity" column="OI_QTY"/>
		<result property="shippingCategory" column="ORD_SHP_CAT"/>
		<result property="VendorName" column="V_NAME"/>
		<result property="PickingDirectionAttempt" column="PD_ATM"/>
		<result property="PickingDirectionDate" column="PD_DT"/>
		<result property="PickingDirectionQuantity" column="PD_QTY"/>
		<result property="PickingDirectionUnrelease" column="PD_URLS"/>
		<result property="orderShippingWay" column="ORD_SHP_WAY"/>
		<result property="orderCheckDate" column="CS_ORD_CHK_DT"/>
		<result property="releaseQuantity" column="CS_RCV_QTY"/>
		<result property="releaseScheduleDate" column="CS_RLS_SCH_DT"/>
		<result property="recieveDate" column="CS_RCV_DT"/>
	</resultMap>
	
	<!-- 상단 현황 전체 건수 -->
	<select id="countAll" resultType="int">
		SELECT count(*) FROM osstem.ord_view
	</select>
	
	<!-- 상단 오스템 전체 건수 -->
	<select id="countOsstem" resultType="int">
		SELECT count(*) FROM osstem.ord_view WHERE ITM_OSS = 1
	</select>
	
	<!-- 상단 협력사합배송 전체 건수 -->
	<select id="countVendorPlus" resultType="int">
		SELECT count(*) FROM osstem.ord_view WHERE ITM_OSS = 0 AND ORD_SHP_WAY LIKE CONCAT('합배송', '')
	</select>
	
	<!-- 상단 협력사직배송 전체 건수 -->
	<select id="countVendorDir" resultType="int">
		SELECT count(*) FROM osstem.ord_view WHERE ITM_OSS = 0 AND ORD_SHP_WAY LIKE CONCAT('직배송', '')
	</select>
	
	<!-- 상단 미출고 전체 건수 -->
	<select id="countunleased" resultType="int">
		SELECT count(*) FROM osstem.ord_view WHERE PD_URLS = 1
	</select>
	
	<select id="select" resultMap="orderViewMap">
		SELECT * FROM osstem.ord_view
	</select>

	<select id="count" resultType="int">
		SELECT count(*) FROM osstem.ord_view
	</select>
	
	<select id="selectByFilter" parameterType="orderfilter" resultMap="orderViewMap">
		SELECT * FROM osstem.ord_view
		WHERE (
			<!-- 오스템 제품  -->
			<if test="itemOSS == 1">						
				(ITM_OSS = 1 AND V_NO IS NULL)
			</if>
					
			<if test="itemOSSPRO == 1">
				<if test="itemOSS == 1">
					OR
				</if>		
				(ITM_OSS = 1 AND V_NO IS NOT NULL)
			</if>
			
			<if test="itemVND == 1">
				<if test="itemOSS == 1 or itemOSSPRO == 1">
					OR
				</if>  					
				(ITM_OSS = 0 AND ORD_SHP_WAY LIKE CONCAT('직배송', ''))
			</if>

			<if test="itemVNDPLUS == 1">
				<if test="itemOSS == 1 or itemOSSPRO == 1 or itemVND == 1">
					OR
				</if>  							
				(ITM_OSS = 0 AND ORD_SHP_WAY LIKE CONCAT('합배송', ''))
			</if>
		)
		 <!-- 긴급 일반  -->               
<<<<<<< HEAD
         <if test="shippingCategory == 1">   <!-- 긴급 -->
=======
         <if test="orderCatagory == 1">   <!-- 긴급 -->
>>>>>>> branch 'master' of http://kosa3.iptime.org:13000/4ever/final-back-end
            AND ORD_SHP_CAT LIKE CONCAT('긴급', '')
         </if>
<<<<<<< HEAD
         <if test="shippingCategory == 2">   <!-- 일반 --> 
=======
         <if test="orderCatagory == 2">   <!-- 일반 --> 
>>>>>>> branch 'master' of http://kosa3.iptime.org:13000/4ever/final-back-end
            AND ORD_SHP_CAT LIKE CONCAT('일반', '')
         </if>
         
         <!-- 출고 미출고  -->         
         <if test="pickingdirectionUnreleased == 1">   <!-- 출고 -->
            AND PD_URLS = 0
         </if>
         <if test="pickingdirectionUnreleased == 2">   <!-- 미출고  -->
            AND PD_URLS = 1
         </if>
         
         <if test='!searchSelected.equals("null") and !searchContent.equals("null") and searchSelected.equals("주문번호")'>
         	AND ORD_NO LIKE CONCAT('%', #{searchContent}, '%');
         </if>
         <if test='!searchSelected.equals("null") and !searchContent.equals("null") and searchSelected.equals("거래처")'>
         	AND CLT_NAME LIKE CONCAT('%', #{searchContent}, '%');
         </if>
	</select>

</mapper>

