<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ows.edu.dao.OrderDao">
	<resultMap id="orderMap" type="order">
		<result property="orderNo" column="ORD_NO"/>
		<result property="shippingCategory" column="ord_shp_cat"/>
		<association property="orderItem" javaType="orderItem">
			<result property="orderItemNo" column="OI_NO"/>
			<result property="orderNo" column="ORD_NO"/>
			<result property="itemCode" column="ITN_CODE"/>
			<result property="qty" column="OI_QTY"/>
		</association>
		<association property="picking" javaType="picking">
			<result property="orderNo" column="ORD_NO"/>
			<result property="orderItemNo" column="oi_no"/>
			<result property="done" column="pic_dn"/>
		</association>
		<association property="release" javaType="release">
			<result property="releaseNo" column="RLS_NO"/>
			<result property="orderNo" column="ORD_NO"/>
			<result property="employeeId" column="EMP_ID"/>
			<result property="releaseDate" column="RLS_DT"/>
			<result property="releaseDone" column="RLS_DN"/>
		</association>
	</resultMap>

	<!-- 전체 -->
	<select id="count" resultType="int">
		SELECT COUNT(*)
		FROM TB_ORD
		WHERE ORD_PRC_ORD = 1
	</select>
	
	<!-- 피킹완료건 -->
	<select id="pickingDoneCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from TB_PIC, tb_ord, tb_ord_itm
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_ORD_ITM.ORD_NO
		    and TB_ORD_ITM.OI_NO = tb_pic.oi_no
		    and TB_PIC.PIC_DN = 1
	</select>
	
	<select id="pickDnCommonCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from TB_PIC, tb_ord, tb_ord_itm
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_ORD_ITM.ORD_NO
		    and TB_ORD_ITM.OI_NO = tb_pic.oi_no
		    and TB_PIC.PIC_DN = 1
		    and tb_ord.ord_shp_cat = "일반"	
	</select>
	
	<select id="pickDnEmergencyCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from TB_PIC, tb_ord, tb_ord_itm
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_ORD_ITM.ORD_NO
		    and TB_ORD_ITM.OI_NO = tb_pic.oi_no
		    and TB_PIC.PIC_DN = 1
		    and tb_ord.ord_shp_cat = "긴급"	
	</select>
	
	<!-- 출고검수/패킹건 -->
	<select id="rlsInspPackingCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from tb_ord, TB_RLS
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_RLS.ord_no
		    and rls_dn = 1;
	</select>
	
	<select id="rlsInspPackCommonCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from tb_ord, TB_RLS
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_RLS.ord_no
		    and rls_dn = 1
		    and tb_ord.ord_shp_cat = "일반"	
	</select>

	<select id="rlsInspPackEmergencyCount" resultType="int">
		select count(DISTINCT tb_ord.ord_no)
		from tb_ord, TB_RLS
		where tb_ord.ORD_PRC_ORD = 1
			and TB_ORD.ORD_NO = TB_RLS.ord_no
		    and rls_dn = 1
		    and tb_ord.ord_shp_cat = "긴급"	
	</select>	
	
	<select id="countProgressOrder" resultType="int">
		SELECT COUNT(*)
		FROM TB_ORD
		WHERE ORD_PRC_ORD IS NULL
	</select> 
</mapper>

